# 实现计划：macOS 应用发布网站

## 概述

本实现计划将设计文档转化为可执行的开发任务。采用增量开发方式，每个任务都建立在前一个任务的基础上，确保代码始终处于可集成状态。

技术栈：HTML5 + CSS3 + Vanilla JavaScript（前端），Node.js + AWS Lambda（后端）

## 任务

- [x] 1. 项目初始化和基础结构
  - 创建项目目录结构（frontend/, backend/, docs/）
  - 设置 package.json 和依赖项
  - 配置 ESLint 和 Prettier
  - 创建 .gitignore 文件
  - _需求：所有需求的基础_

- [ ] 2. 前端页面结构和导航
  - [x] 2.1 创建 HTML 基础结构
    - 实现语义化 HTML5 结构（header, nav, main, section, footer）
    - 创建导航栏和页脚
    - 设置页面各个区域（hero, features, download, guestbook）
    - _需求：1.1, 5.1, 5.4, 10.4_
  
  - [x] 2.2 实现导航功能
    - 实现平滑滚动到锚点
    - 实现滚动时导航高亮
    - 实现移动端汉堡菜单
    - _需求：5.2, 5.3, 5.5_
  
  - [ ]* 2.3 编写导航功能的属性测试
    - **属性 6：导航平滑滚动**
    - **验证需求：5.2**
    - **属性 7：导航状态同步**
    - **验证需求：5.3**

- [ ] 3. CSS 样式系统和响应式设计
  - [x] 3.1 创建 CSS 变量和基础样式
    - 定义颜色主题（CSS 变量）
    - 定义字体系统（系统字体栈）
    - 设置全局样式和重置
    - _需求：7.1, 7.2_
  
  - [ ] 3.2 实现响应式布局
    - 使用 CSS Grid 和 Flexbox
    - 实现移动优先的媒体查询
    - 确保触摸目标尺寸（最小 44x44px）
    - 实现固定导航栏
    - _需求：1.3, 1.5, 4.1, 4.2, 4.3, 4.4, 4.5_
  
  - [ ]* 3.3 编写响应式设计的属性测试
    - **属性 1：导航栏固定定位**
    - **验证需求：1.3**
    - **属性 2：响应式布局适配**
    - **验证需求：1.5, 4.4**
    - **属性 5：触摸目标尺寸**
    - **验证需求：4.5**

- [ ] 4. 主页内容区域
  - [x] 4.1 实现 Hero 区域
    - 创建应用名称、图标和描述展示
    - 添加主要 CTA 按钮（下载）
    - 添加应用截图展示区
    - _需求：1.1, 1.2_
  
  - [x] 4.2 实现特性展示区
    - 创建特性网格布局
    - 实现特性卡片组件（图标、标题、描述）
    - 添加滚动动画效果
    - _需求：3.1, 3.2, 3.4_
  
  - [ ]* 4.3 编写特性展示的属性测试
    - **属性 4：特性项完整性**
    - **验证需求：3.2**

- [ ] 5. 检查点 - 确保静态页面完整
  - 确保所有测试通过，询问用户是否有问题

- [ ] 6. 可访问性实现
  - [ ] 6.1 添加可访问性属性
    - 为所有图片添加 alt 文本
    - 确保颜色对比度符合 WCAG AA 标准
    - 添加 ARIA 标签和角色
    - 确保键盘导航可用
    - _需求：10.1, 10.2, 10.3, 10.5_
  
  - [ ]* 6.2 编写可访问性属性测试
    - **属性 16：图片替代文本**
    - **验证需求：10.1**
    - **属性 17：颜色对比度**
    - **验证需求：10.2**
    - **属性 18：键盘可访问性**
    - **验证需求：10.3**
    - **属性 19：语义化 HTML**
    - **验证需求：10.4**
    - **属性 20：内容朗读顺序**
    - **验证需求：10.5**

- [ ] 7. 性能优化
  - [ ] 7.1 实现图片优化
    - 添加图片懒加载（loading="lazy"）
    - 使用响应式图片（srcset）
    - 压缩图片资源
    - _需求：6.2, 6.3_
  
  - [ ]* 7.2 编写懒加载属性测试
    - **属性 8：图片懒加载**
    - **验证需求：6.3**

- [ ] 8. 后端基础设施 - DynamoDB 表设计
  - [ ] 8.1 创建 DynamoDB 表定义
    - 定义 Downloads 表结构
    - 定义 Messages 表结构
    - 定义 RateLimits 表结构（包含 TTL）
    - 创建必要的索引
    - _需求：2.6, 8.2, 9.1_
  
  - [ ] 8.2 创建 AWS CloudFormation 模板
    - 定义所有 DynamoDB 表
    - 定义 Lambda 函数资源
    - 定义 API Gateway 资源
    - 定义 IAM 角色和权限
    - _需求：所有后端需求_

- [ ] 9. 下载功能实现
  - [ ] 9.1 实现前端下载按钮
    - 创建下载按钮组件
    - 显示版本号和发布日期
    - 显示总下载次数
    - 实现下载点击事件
    - _需求：2.1, 2.3, 2.4, 2.7_
  
  - [ ] 9.2 实现下载统计 Lambda 函数
    - 创建 recordDownload Lambda 函数
    - 实现 DynamoDB 计数器递增逻辑
    - 实现错误处理和重试
    - _需求：2.6_
  
  - [ ] 9.3 实现获取统计 Lambda 函数
    - 创建 getDownloadStats Lambda 函数
    - 从 DynamoDB 读取总下载次数
    - 实现缓存策略
    - _需求：2.7_
  
  - [ ]* 9.4 编写下载统计的属性测试
    - **属性 3：下载计数递增**
    - **验证需求：2.6**
  
  - [ ]* 9.5 编写下载功能的单元测试
    - 测试下载按钮点击事件
    - 测试 API 调用失败的错误处理
    - 测试下载次数显示更新
    - _需求：2.1, 2.2, 2.5_

- [ ] 10. 检查点 - 确保下载功能完整
  - 确保所有测试通过，询问用户是否有问题

- [ ] 11. 留言板前端实现
  - [ ] 11.1 创建留言板 UI 组件
    - 创建留言列表组件
    - 创建留言表单（昵称、内容输入）
    - 实现表单验证（客户端）
    - 显示提交按钮和速率限制提示
    - _需求：8.1, 8.5_
  
  - [ ] 11.2 实现留言显示逻辑
    - 实现留言渲染函数
    - 显示昵称、内容、时间戳
    - 实现时间倒序排列
    - 实现分页功能
    - _需求：8.2, 8.3, 8.4_
  
  - [ ] 11.3 实现留言提交逻辑
    - 实现表单提交处理
    - 调用后端 API
    - 处理成功和错误响应
    - 实现客户端速率限制检查
    - _需求：8.2, 9.2, 9.5_
  
  - [ ]* 11.4 编写留言显示的属性测试
    - **属性 10：留言显示完整性**
    - **验证需求：8.2**
    - **属性 11：留言时间倒序**
    - **验证需求：8.3**
  
  - [ ]* 11.5 编写表单验证的属性测试
    - **属性 12：表单输入验证**
    - **验证需求：8.5**

- [ ] 12. 留言板后端实现
  - [ ] 12.1 实现速率限制中间件
    - 创建 checkRateLimit 函数
    - 使用 IP 地址哈希作为标识
    - 检查 RateLimits 表
    - 返回是否允许请求和等待时间
    - _需求：9.1, 9.3, 9.4_
  
  - [ ] 12.2 实现提交留言 Lambda 函数
    - 创建 submitMessage Lambda 函数
    - 集成速率限制检查
    - 验证输入（服务器端）
    - 存储留言到 DynamoDB
    - 实现错误处理
    - _需求：8.2, 9.1, 9.5_
  
  - [ ] 12.3 实现获取留言 Lambda 函数
    - 创建 getMessages Lambda 函数
    - 从 DynamoDB 查询留言（时间倒序）
    - 实现分页逻辑
    - 返回留言列表和分页信息
    - _需求：8.3, 8.4_
  
  - [ ]* 12.4 编写速率限制的属性测试
    - **属性 13：速率限制执行**
    - **验证需求：9.1**
    - **属性 14：访问者标识追踪**
    - **验证需求：9.3**
    - **属性 15：速率限制过期**
    - **验证需求：9.4**
  
  - [ ]* 12.5 编写留言后端的单元测试
    - 测试输入验证（空内容、过长内容、特殊字符）
    - 测试 DynamoDB 错误处理
    - 测试速率限制边缘情况
    - _需求：8.5, 9.2_

- [ ] 13. 检查点 - 确保留言板功能完整
  - 确保所有测试通过，询问用户是否有问题

- [ ] 14. API Gateway 配置
  - [ ] 14.1 创建 API Gateway REST API
    - 定义 API 端点（/api/downloads, /api/messages）
    - 配置 CORS
    - 集成 Lambda 函数
    - 配置请求/响应映射
    - _需求：所有 API 需求_
  
  - [ ] 14.2 配置 API Gateway 缓存和限流
    - 启用缓存（可选）
    - 配置使用计划和 API 密钥（可选）
    - 设置请求限流
    - _需求：6.5_

- [ ] 15. 前后端集成
  - [ ] 15.1 实现 API 客户端
    - 创建统一的 API 调用函数
    - 实现错误处理和重试逻辑
    - 添加请求超时
    - _需求：所有 API 交互_
  
  - [ ] 15.2 连接前端和后端
    - 更新下载按钮调用真实 API
    - 更新留言板调用真实 API
    - 测试端到端流程
    - _需求：2.6, 8.2, 9.1_
  
  - [ ]* 15.3 编写集成测试
    - 测试完整的下载流程
    - 测试完整的留言提交和显示流程
    - 测试速率限制的客户端和服务器端协同
    - _需求：2.1-2.7, 8.1-8.5, 9.1-9.5_

- [ ] 16. 错误处理和用户反馈
  - [ ] 16.1 实现前端错误处理
    - 创建错误提示组件
    - 处理网络请求失败
    - 处理下载失败
    - 处理速率限制错误（显示倒计时）
    - _需求：2.5, 9.2_
  
  - [ ] 16.2 实现加载状态
    - 添加加载指示器
    - 禁用按钮防止重复提交
    - 显示下载进度（如果可能）
    - _需求：2.2_

- [ ] 17. 部署配置
  - [ ] 17.1 配置 S3 静态网站托管
    - 创建 S3 存储桶
    - 配置静态网站托管
    - 设置存储桶策略
    - 上传静态文件
    - _需求：所有前端需求_
  
  - [ ] 17.2 配置 CloudFront CDN
    - 创建 CloudFront 分发
    - 配置源（S3 和 API Gateway）
    - 设置缓存策略
    - 配置 HTTPS 证书
    - _需求：6.1, 6.5_
  
  - [ ] 17.3 部署 Lambda 函数和 API Gateway
    - 打包 Lambda 函数代码
    - 部署到 AWS
    - 配置环境变量
    - 测试 API 端点
    - _需求：所有后端需求_

- [ ] 18. 最终测试和优化
  - [ ]* 18.1 运行完整测试套件
    - 运行所有单元测试
    - 运行所有属性测试（每个至少 100 次迭代）
    - 运行集成测试
    - 检查代码覆盖率
    - _需求：所有需求_
  
  - [ ] 18.2 性能测试和优化
    - 测试首屏加载时间
    - 优化关键渲染路径
    - 压缩和最小化资源
    - 验证懒加载工作正常
    - _需求：6.1, 6.2, 6.3, 6.4_
  
  - [ ] 18.3 可访问性审计
    - 使用 Lighthouse 审计
    - 使用屏幕阅读器测试
    - 验证键盘导航
    - 检查颜色对比度
    - _需求：10.1-10.5_

- [ ] 19. 文档和部署指南
  - [ ] 19.1 编写部署文档
    - 记录 AWS 资源配置步骤
    - 记录环境变量和配置
    - 创建部署脚本
    - _需求：所有需求_
  
  - [ ] 19.2 编写用户文档
    - 创建 README.md
    - 记录项目结构
    - 记录开发和测试命令
    - 记录成本估算和优化建议
    - _需求：所有需求_

- [ ] 20. 最终检查点
  - 确保所有测试通过，询问用户是否准备好上线

## 注意事项

- 标记为 `*` 的任务是可选的，可以跳过以加快 MVP 开发
- 每个任务都引用了具体的需求编号，确保可追溯性
- 检查点任务确保增量验证，及早发现问题
- 属性测试必须运行至少 100 次迭代
- 所有代码应该遵循 ESLint 和 Prettier 配置
- 优先实现核心功能，然后添加优化和测试

## 测试配置

**前端测试**：
- 测试框架：Jest + jsdom
- 属性测试库：fast-check
- 每个属性测试至少 100 次迭代

**后端测试**：
- 测试框架：Jest
- 属性测试库：fast-check
- Mock AWS SDK 调用

**集成测试**：
- 使用真实的 AWS 资源（开发环境）
- 或使用 LocalStack 模拟 AWS 服务


## 域名注册和配置指南

域名注册是部署前的准备工作，不属于代码实现任务。以下是推荐的步骤：

### 域名注册选项

**选项 1：AWS Route 53（推荐，与 AWS 集成最好）**
1. 登录 AWS 控制台
2. 进入 Route 53 服务
3. 点击"注册域名"
4. 搜索并选择您想要的域名（如 myapp.com）
5. 完成购买（价格：约 $12-15/年，取决于域名后缀）
6. AWS 会自动创建托管区域

**选项 2：第三方域名注册商**
- **Namecheap**：价格实惠，界面友好（约 $8-12/年）
- **GoDaddy**：知名度高，但价格稍贵
- **阿里云（万网）**：如果在中国，推荐使用（约 ¥55-80/年）
- **腾讯云**：同样适合中国用户

### 域名配置步骤

**如果使用 AWS Route 53**：
1. 域名注册后，Route 53 会自动创建托管区域
2. 在 CloudFront 分发中配置自定义域名
3. 在 Route 53 中创建 A 记录，指向 CloudFront 分发
4. 配置 SSL 证书（使用 AWS Certificate Manager，免费）

**如果使用第三方注册商**：
1. 在注册商处购买域名
2. 在 AWS Route 53 创建托管区域
3. 将注册商的 DNS 服务器改为 Route 53 的 NS 记录
4. 按照上述步骤配置 CloudFront 和 SSL

### SSL 证书配置

使用 **AWS Certificate Manager (ACM)** 申请免费 SSL 证书：
1. 进入 ACM 控制台（必须在 us-east-1 区域，用于 CloudFront）
2. 点击"请求证书"
3. 输入您的域名（如 myapp.com 和 www.myapp.com）
4. 选择 DNS 验证
5. 在 Route 53 中添加验证记录（如果使用 Route 53，可以一键添加）
6. 等待验证完成（通常几分钟）
7. 在 CloudFront 分发中关联此证书

### 成本估算（包含域名）

**月度成本**：
- 域名：$12/年 ≈ $1/月
- AWS 服务：$2-3/月（或免费套餐内）
- **总计：约 $3-4/月**

**首年成本（使用 AWS 免费套餐）**：
- 域名：$12
- AWS 服务：接近 $0（免费套餐）
- **总计：约 $12/年**

### 推荐配置

对于个人 macOS 应用网站，推荐：
1. **域名**：选择简短、易记的 .com 域名
2. **注册商**：AWS Route 53（方便集成）或 Namecheap（价格实惠）
3. **SSL**：使用 AWS Certificate Manager（免费）
4. **DNS**：使用 Route 53（与 CloudFront 集成最好）

### 注意事项

- 域名注册后需要 24-48 小时全球生效
- SSL 证书验证通常需要几分钟到几小时
- 建议先完成网站开发和测试，再购买域名
- 可以先使用 CloudFront 提供的默认域名进行测试
